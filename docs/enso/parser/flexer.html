<!DOCTYPE HTML>
<html lang="en" >
    <head><meta charset="UTF-8">
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"><title>Flexer Â· Enso Developer Documentation</title><meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="description" content="The developer documentation for the Enso compiler, runtime, and IDE..
"><meta name="generator" content="Jekyll (using style of GitBook 3.2.3)"><meta name="author" content="Enso.org"><link rel="stylesheet" href="/gitbook/style.css">
<link rel="stylesheet" href="/gitbook/gitbook-plugin-fontsettings/website.css">
<!-- <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css"> -->

<link rel="stylesheet" href="/gitbook/rouge-highlight-colorful.css">

<meta name="HandheldFriendly" content="true"/>
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="/gitbook/images/apple-touch-icon-precomposed-152.png">
<link rel="shortcut icon" href="/gitbook/images/favicon.ico" type="image/x-icon">
        

        
        


        
        
        

        
        
        

        
            <link rel="prev" href="/docs/enso/parser/architecture.html" />
        

        
            <link rel="next" href="/docs/enso/parser/lexer.html" />
        
    </head>
    <body>
        
        <div class="book"><div class="book-summary">
    <div id="search-searchbar">
    </div>
    <div class="post-list" id="search-hits">
        
      </div>
      <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>
    <nav role="navigation">
        <ul class="summary">
            
            <li class="chapter" data-level="1.1" data-path="/">
            
                <a href="/">
                    Home
                </a>
            </li>

            <li class="divider"></li>
            
            
            
            
            

            
            
        
            
            <li class="chapter" data-level="1.1" data-path="/docs/enso/parser ">
                    <a href="/docs/enso/parser">
                        Go back
                    </a>
                </li>
                <li class="divider"></li>
            
                
             
            
            
            
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/">
                    
                        <a href="/docs/enso/parser/">
                            
                                Enso&#39;s Parser
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/tech-analysis.html">
                    
                        <a href="/docs/enso/parser/tech-analysis.html">
                            
                                Technology Analysis
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/architecture.html">
                    
                        <a href="/docs/enso/parser/architecture.html">
                            
                                Parser Architecture Overview
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter active" data-level="1.2" data-path="/docs/enso/parser/flexer.html">
                    
                        <a href="/docs/enso/parser/flexer.html">
                            
                                Flexer
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/lexer.html">
                    
                        <a href="/docs/enso/parser/lexer.html">
                            
                                Lexer
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/macro-resolution.html">
                    
                        <a href="/docs/enso/parser/macro-resolution.html">
                            
                                Macro Resolution
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/operator-resolution.html">
                    
                        <a href="/docs/enso/parser/operator-resolution.html">
                            
                                Operator Resolution
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/construct-resolution.html">
                    
                        <a href="/docs/enso/parser/construct-resolution.html">
                            
                                Construct Resolution
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/parser-driver.html">
                    
                        <a href="/docs/enso/parser/parser-driver.html">
                            
                                Parser Driver
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/ast.html">
                    
                        <a href="/docs/enso/parser/ast.html">
                            
                                AST
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/jvm-object-generation.html">
                    
                        <a href="/docs/enso/parser/jvm-object-generation.html">
                            
                                JVM Object Generation
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
                    
                    <li class="chapter" data-level="1.1" data-path="/docs/enso/parser/reader.html">
                    
                        <a href="/docs/enso/parser/reader.html">
                            
                                Reading Source Code
                            
                        </a>
                    </li>
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            
            
                
            
            

            
        
        </ul>
    </nav>
</div>
<div class="book-body"><div class="body-inner">
    <div class="book-header" role="navigation">
        <!-- Title -->
        <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i>
            
                <a href="." >Flexer</a>
            
        </h1>
    </div>
    <div class="page-wrapper" tabindex="-1" role="main">
        <div class="page-inner">
            <div id="book-search-results">
                <div class="search-noresults">
                    <section class="normal markdown-section">
                        <h1 id="flexer">Flexer</h1>

<p>The flexer is a finite-automata-based engine for generating lexers. Akin to
<code class="language-plaintext highlighter-rouge">flex</code> and other lexer generators, it is given a definition as a series of rules
from which it then generates code for a highly-optimised lexer.</p>

<!-- MarkdownTOC levels="2,3" autolink="true" -->

<ul>
  <li><a href="#pattern-description">Pattern Description</a></li>
  <li><a href="#state-management">State Management</a></li>
  <li><a href="#code-generation">Code Generation</a>
    <ul>
      <li><a href="#automated-code-generation">Automated Code Generation</a></li>
      <li><a href="#notes-on-code-generation">Notes on Code Generation</a></li>
    </ul>
  </li>
  <li><a href="#an-example">An Example</a></li>
</ul>

<!-- /MarkdownTOC -->

<h2 id="pattern-description">Pattern Description</h2>

<p>The definition of a lexer using the flexer library consists of a set of rules
for how to behave when matching portions of syntax. These rules behave as
follows:</p>

<ul>
  <li>A rule describes a regex-like pattern.</li>
  <li>It also describes the code to be executed when the pattern is matched.</li>
</ul>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pub</span> <span class="k">fn</span> <span class="nf">lexer_definition</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="c">// ...</span>

    <span class="k">let</span> <span class="n">chr</span> <span class="o">=</span> <span class="n">alphaNum</span> <span class="p">|</span> <span class="sc">'_'</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">blank</span> <span class="o">=</span> <span class="nn">Pattern</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="sc">'_'</span><span class="p">)</span>

    <span class="n">lexer</span><span class="nf">.rule</span><span class="p">(</span><span class="n">lexer</span><span class="py">.root</span><span class="p">,</span><span class="n">blank</span><span class="p">,</span><span class="s">"self.on_ident(token::blank(self.start_location))"</span><span class="p">);</span>

    <span class="c">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>A pattern, such as <code class="language-plaintext highlighter-rouge">chr</code>, or <code class="language-plaintext highlighter-rouge">blank</code> is a description of the characters that
should be matched for that pattern to match. The flexer library provides a set
of basic matchers for doing this.</p>

<p>A <code class="language-plaintext highlighter-rouge">lexer.rule(...)</code> definition consists of the following parts:</p>

<ul>
  <li>A state, used for grouping rules and named for debugging (see the section on
<a href="#state-management">state management</a> below).</li>
  <li>A pattern, as described above.</li>
  <li>The code that is executed when the pattern matches.</li>
</ul>

<h2 id="state-management">State Management</h2>

<p>States in the flexer engine provide a mechanism for grouping sets of rules
together known as <code class="language-plaintext highlighter-rouge">State</code>. At any given time, only rules from the <em>active</em> state
are considered by the lexer.</p>

<ul>
  <li>States are named for purposes of debugging.</li>
  <li>You can activate another state from within the flexer instance by using
<code class="language-plaintext highlighter-rouge">state.push(new_state)</code>.</li>
  <li>You can deactivate the topmost state by using <code class="language-plaintext highlighter-rouge">state.pop()</code>.</li>
</ul>

<h2 id="code-generation">Code Generation</h2>

<p>The patterns in a lexer definition are used to generate a highly-efficient and
specialised lexer. This translation process works as follows:</p>

<ol>
  <li>All rules are taken and used to generate an NFA.</li>
  <li>A DFA is generated from the NFA using the standard
<a href="https://en.wikipedia.org/wiki/Powerset_construction">subset construction</a>
algorithm, but with some additional optimisations that ensure the following
properties hold:
    <ul>
      <li>Patterns are matched in the order that they are defined.</li>
      <li>The associated code chunks are maintained properly.</li>
      <li>Lexing is <code class="language-plaintext highlighter-rouge">O(n)</code>, where <code class="language-plaintext highlighter-rouge">n</code> is the size of the input.</li>
    </ul>
  </li>
  <li>The DFA is used to generate the code for a lexer <code class="language-plaintext highlighter-rouge">Engine</code> struct, containing
the <code class="language-plaintext highlighter-rouge">Lexer</code> definition.</li>
</ol>

<p>The <code class="language-plaintext highlighter-rouge">Engine</code> generated through this process contains a main loop that consumes
the input stream character-by-character, evaluating a big switch generated from
the DFA using functions from the <code class="language-plaintext highlighter-rouge">Lexer</code>.</p>

<p>Lexing proceeds from top-to-bottom of the rules, and the first expression that
<em>matches fully</em> is chosen. This differs from other common lexer generators, as
they mostly choose the <em>longest</em> match instead. Once the pattern is matched, the
associated code is executed and the process starts over again until the input
stream has been consumed.</p>

<h3 id="automated-code-generation">Automated Code Generation</h3>

<p>In order to avoid the lexer definition getting out of sync with its
implementation (the generated engine), it is necessary to create a separate
crate for the generated engine that has the lexer definition as one of its
dependencies.</p>

<p>This separation enables a call to <code class="language-plaintext highlighter-rouge">flexer.generate_specialized_code()</code> in
<code class="language-plaintext highlighter-rouge">build.rs</code> (or a macro) during compilation. The output can be stored in a new
file i.e. <code class="language-plaintext highlighter-rouge">lexer-engine.rs</code> and exported from the library with
<code class="language-plaintext highlighter-rouge">include!("lexer-engine.rs")</code>. The project structure therefore appears as
follows:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- lib/rust/lexer/
  - definition/
    - src/
      - lexer.rs
    - cargo.toml

  - generation/
    - src/
      - lexer.rs &lt;-- include!("lexer-engine.rs")
    - build.rs   &lt;-- calls `lexer_definition::lexer_source_code()`
                  -- and saves its output to `src/lexer-engine.rs`
    - cargo.toml &lt;-- lexer-definition is in dependencies and build-dependencies
</code></pre></div></div>

<p>With this design, <code class="language-plaintext highlighter-rouge">flexer.generate_specialized_code()</code> is going to be executed
on each rebuild of <code class="language-plaintext highlighter-rouge">lexer/generation</code>. Therefore, <code class="language-plaintext highlighter-rouge">generation</code> should contain
only the minimum amount of logic (i.e. tests should be in separate crate) and
its dependencies should optimally involve only such code which directly
influences the content of generated code (in order to minimize the unnecessary
calls to expensive flexer specialization).</p>

<h3 id="notes-on-code-generation">Notes on Code Generation</h3>

<p>The following properties are likely to hold for the code generation machinery.</p>

<ul>
  <li>The vast majority of the code generated by the flexer is going to be the same
for all lexers.</li>
  <li>The primary generation is in <code class="language-plaintext highlighter-rouge">consume_next_character</code>, which takes a <code class="language-plaintext highlighter-rouge">Lexer</code>
as an argument.</li>
</ul>

<h2 id="an-example">An Example</h2>

<p>The following code provides a sketchy example of the intended API for the flexer
code generation using the definition of a simple lexer.</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">crate</span><span class="p">::</span><span class="nn">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="k">use</span> <span class="n">flexer</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">flexer</span><span class="p">::</span><span class="n">Flexer</span><span class="p">;</span>



<span class="c">// =============</span>
<span class="c">// === Token ===</span>
<span class="c">// =============</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">Token</span> <span class="p">{</span>
    <span class="n">location</span> <span class="p">:</span> <span class="nn">flexer</span><span class="p">::</span><span class="n">Location</span><span class="p">,</span>
    <span class="n">ast</span>      <span class="p">:</span> <span class="n">TokenAst</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="n">TokenAst</span> <span class="p">{</span>
    <span class="nf">Var</span><span class="p">(</span><span class="n">ImString</span><span class="p">),</span>
    <span class="nf">Cons</span><span class="p">(</span><span class="n">ImString</span><span class="p">),</span>
    <span class="n">Blank</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Token</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">location</span><span class="p">:</span><span class="n">Location</span><span class="p">,</span> <span class="n">ast</span><span class="p">:</span><span class="n">TokenAst</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Self</span> <span class="p">{</span>
        <span class="n">Self</span> <span class="p">{</span><span class="n">location</span><span class="p">,</span><span class="n">ast</span><span class="p">}</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">var</span><span class="p">(</span><span class="n">location</span><span class="p">:</span><span class="n">Location</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="k">impl</span> <span class="n">Into</span><span class="o">&lt;</span><span class="n">ImString</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Self</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">ast</span> <span class="o">=</span> <span class="nn">TokenAst</span><span class="p">::</span><span class="nf">Var</span><span class="p">(</span><span class="n">name</span><span class="nf">.into</span><span class="p">());</span>
        <span class="nn">Self</span><span class="p">::</span><span class="nf">new</span><span class="p">(</span><span class="n">location</span><span class="p">,</span><span class="n">ast</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="o">...</span>
<span class="p">}</span>



<span class="c">// =============</span>
<span class="c">// === Lexer ===</span>
<span class="c">// =============</span>

<span class="nd">#[derive(Debug,Default)]</span>
<span class="k">struct</span> <span class="n">Lexer</span><span class="o">&lt;</span><span class="n">T</span><span class="p">:</span><span class="nn">Flexer</span><span class="p">::</span><span class="n">State</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">current</span> <span class="p">:</span> <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Token</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">tokens</span>  <span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Token</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">state</span>   <span class="p">:</span> <span class="n">T</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Lexer</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">on_ident</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">,</span> <span class="n">tok</span><span class="p">:</span><span class="n">Token</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.current</span> <span class="o">=</span> <span class="nf">Some</span><span class="p">(</span><span class="n">tok</span><span class="p">);</span>
        <span class="k">self</span><span class="py">.state</span><span class="nf">.push</span><span class="p">(</span><span class="k">self</span><span class="py">.ident_sfx_check</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">on_ident_err_sfx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="nd">println!</span><span class="p">(</span><span class="s">"OH NO!"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">on_no_ident_err_sfx</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">current</span> <span class="o">=</span> <span class="nn">std</span><span class="p">::</span><span class="nn">mem</span><span class="p">::</span><span class="nf">take</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="py">.current</span><span class="p">)</span><span class="nf">.unwrap</span><span class="p">();</span>
        <span class="k">self</span><span class="py">.tokens</span><span class="nf">.push_back</span><span class="p">(</span><span class="n">current</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nn">Flexer</span><span class="p">::</span><span class="n">Definition</span> <span class="n">Lexer</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">state</span>     <span class="p">(</span><span class="o">&amp;</span>    <span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span>    <span class="nn">flexer</span><span class="p">::</span><span class="n">State</span> <span class="p">{</span> <span class="o">&amp;</span>    <span class="k">self</span><span class="py">.state</span> <span class="p">}</span>
    <span class="k">fn</span> <span class="nf">state_mut</span> <span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">flexer</span><span class="p">::</span><span class="n">State</span> <span class="p">{</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="k">self</span><span class="py">.state</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">pub</span> <span class="k">fn</span> <span class="nf">lexer_source_code</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">lexer</span> <span class="o">=</span> <span class="nn">Flexer</span><span class="p">::</span><span class="o">&lt;</span><span class="n">Lexer</span><span class="o">&lt;</span><span class="mi">_</span><span class="o">&gt;&gt;</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>

    <span class="k">let</span> <span class="n">chr</span>     <span class="o">=</span> <span class="n">alphaNum</span> <span class="p">|</span> <span class="sc">'_'</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">blank</span>   <span class="o">=</span> <span class="nn">Pattern</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="sc">'_'</span><span class="p">);</span>
    <span class="k">let</span> <span class="n">body</span>    <span class="o">=</span> <span class="n">chr</span><span class="py">.many</span> <span class="o">&gt;&gt;</span> <span class="sc">'\''</span><span class="nf">.many</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">var</span>     <span class="o">=</span> <span class="n">lowerLetter</span> <span class="o">&gt;&gt;</span> <span class="n">body</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">cons</span>    <span class="o">=</span> <span class="n">upperLetter</span> <span class="o">&gt;&gt;</span> <span class="n">body</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">breaker</span> <span class="o">=</span> <span class="s">"^`!@#$%^&amp;*()-=+[]{}|;:&lt;&gt;,./ </span><span class="se">\t\r\n\\</span><span class="s">"</span><span class="p">;</span>

    <span class="k">let</span> <span class="n">sfx_check</span> <span class="o">=</span> <span class="n">lexer</span><span class="nf">.add</span><span class="p">(</span><span class="nf">State</span><span class="p">(</span><span class="s">"Identifier Suffix Check"</span><span class="p">));</span>

    <span class="n">lexer</span><span class="nf">.rule</span><span class="p">(</span><span class="n">lexer</span><span class="py">.root</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="s">"self.on_ident(Token::var(self.start_location,self.current_match()))"</span><span class="p">);</span>
    <span class="n">lexer</span><span class="nf">.rule</span><span class="p">(</span><span class="n">lexer</span><span class="py">.root</span><span class="p">,</span><span class="n">cons</span><span class="p">,</span><span class="s">"self.on_ident(token::cons(self.start_location,self.current_match()))"</span><span class="p">);</span>
    <span class="n">lexer</span><span class="nf">.rule</span><span class="p">(</span><span class="n">lexer</span><span class="py">.root</span><span class="p">,</span><span class="n">blank</span><span class="p">,</span><span class="s">"self.on_ident(token::blank(self.start_location))"</span><span class="p">);</span>
    <span class="n">lexer</span><span class="nf">.rule</span><span class="p">(</span><span class="n">sfx_check</span><span class="p">,</span><span class="n">err_sfx</span><span class="p">,</span><span class="s">"self.on_ident_err_sfx()"</span><span class="p">);</span>
    <span class="n">lexer</span><span class="nf">.rule</span><span class="p">(</span><span class="n">sfx_check</span><span class="p">,</span><span class="nn">Flexer</span><span class="p">::</span><span class="n">always</span><span class="p">,</span><span class="s">"self.on_no_ident_err_sfx()"</span><span class="p">);</span>
    <span class="o">...</span>
    <span class="n">lexer</span><span class="nf">.generate_specialized_code</span><span class="p">()</span> <span class="c">// This code needs to become a source file, probably via build.rs</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Some things to note:</p>

<ul>
  <li>The function definitions in <code class="language-plaintext highlighter-rouge">Lexer</code> take <code class="language-plaintext highlighter-rouge">self</code> as their first argument
because <code class="language-plaintext highlighter-rouge">Engine</code> implements <code class="language-plaintext highlighter-rouge">Deref</code> and <code class="language-plaintext highlighter-rouge">DerefMut</code> to <code class="language-plaintext highlighter-rouge">Lexer</code>.</li>
</ul>

                        
                        
                        <a href="https://github.com/enso-org/enso/blob/main/docs/enso/parser/flexer.md">Open this doc on GitHub</a>
                        
                    </section>
                </div>

                 <!--<div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.6.0/dist/instantsearch-theme-algolia.min.css">

<script>
var search = instantsearch({
  appId: '3PBI3MMCBE',
  apiKey: '55d673c313b717b7386df8c9418588d4',
  indexName: 'jekyll',
  searchFunction(helper) {
    var container = document.querySelector('#search-hits');
    container.style.display = helper.state.query === '' ? 'none' : '';

    helper.search();
  }
});

var hitTemplate = function(hit) {
  let date = '';
  if (hit.date) {
    date = moment.unix(hit.date).format('MMM D, YYYY');
  }

  let url = `${hit.url}#${hit.anchor}`;

  var title = hit._highlightResult.title.value;

  var content = hit._highlightResult.html.value;

  return `
    <li class="post-item chapter">
      <a href="${url}" class="post-link">${title}</a>
      <div class="post-snippet">${content}</div>
    </li>
  `;
}


search.addWidget(
  instantsearch.widgets.searchBox({
    container: '#search-searchbar',
    placeholder: 'Search the docs',
    poweredBy: true // This is required if you're on the free Community plan
  })
);

search.addWidget(
  instantsearch.widgets.hits({
    container: '#search-hits',
    templates: {
      item: hitTemplate
    }
  })
);

search.start();
</script>

<style>
.ais-search-box {
  max-width: 100%;
  margin-bottom: 15px;
}
.post-item {
  margin-bottom: 30px;
}
.post-link .ais-Highlight {
  color: #111;
  font-style: normal;
  text-decoration: underline;
}
.post-breadcrumbs {
  color: #424242;
  display: block;
}
.post-breadcrumb {
  font-size: 18px;
  color: #424242;
}
.post-breadcrumb .ais-Highlight {
  font-weight: bold;
  font-style: normal;
}
.post-snippet .ais-Highlight {
  color: #2a7ae2;
  font-style: normal;
  font-weight: bold;
}
.post-snippet img {
  display: none;
}

.post-list {
    list-style:none;
    margin:0;
    padding: 10px 15px;
    -webkit-transition:top .5s ease;
    -moz-transition:top .5s ease;
    -o-transition:top .5s ease;
    transition:top .5s ease
}

#search-hits::after {
    content: '';
    display: block;
    height: 1px;
    margin: 7px 0;
    overflow: hidden;
    background: rgba(0,0,0,.07);
}
</style>-->
            </div>
        </div>
    </div>
</div>

                <a href="/docs/enso/parser/architecture.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Parser Architecture Overview">
                    <i class="fa fa-angle-left"></i>
                </a>
                

                
                    <a href="/docs/enso/parser/lexer.html" class="navigation navigation-next navigation-unique" aria-label="Next page: Lexer">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            
            </div>

            <script>
            var gitbook = gitbook || [];
            gitbook.push(function() {
                gitbook.page.hasChanged({
    "page": {
        "title": "Introduction",
        "level": "1.1",
        "depth": 1,
        
        "dir": "ltr"
    },    "config": {
        "plugins": ["fontsettings", "highlight", "livereload", "lunr", "search", "sharing", "theme-default", "livereload"],
        "styles": {
            "ebook": "styles/ebook.css",
            "epub": "styles/epub.css",
            "mobi": "styles/mobi.css",
            "pdf": "styles/pdf.css",
            "print": "styles/print.css",
            "website": "styles/website.css"
        },
        "pluginsConfig": {
            "fontsettings": {
                "family": "sans",
                "size": 2,
                "theme": "white"
            },
            "highlight": {},
            "livereload": {},
            "lunr": {
                "ignoreSpecialCharacters": false,
                "maxIndexSize": 1000000
            },
            "search": {},
            "sharing": {
                "all": ["facebook", "google", "twitter", "weibo", "instapaper"],
                "facebook": true,
                "google": false,
                "instapaper": false,
                "twitter": true,
                "vk": false,
                "weibo": false
            },
            "theme-default": {
                "showLevel": false,
                "styles": {
                    "ebook": "styles/ebook.css",
                    "epub": "styles/epub.css",
                    "mobi": "styles/mobi.css",
                    "pdf": "styles/pdf.css",
                    "print": "styles/print.css",
                    "website": "styles/website.css"
                }
            }
        },
        "theme": "default",
        "author": "Tao He",
        "pdf": {
            "pageNumbers": true,
            "fontSize": 12,
            "fontFamily": "Arial",
            "paperSize": "a4",
            "chapterMark": "pagebreak",
            "pageBreaksBefore": "/",
            "margin": {
                "right": 62,
                "left": 62,
                "top": 56,
                "bottom": 56
            }
        },
        "structure": {
            "langs": "LANGS.md",
            "readme": "README.md",
        },
        "variables": {},
        "title": "Enso Developer Documentation",
        "language": "en",
        "gitbook": "*"
    },
    "file": {
        "path": "docs/enso/parser/flexer.md",
        "mtime": "",
        "type": "markdown"
    },
    "gitbook": {
        "version": "3.2.3",
        "time": "2020-07-29 11:52:07 +0000"
    },
    "basePath": "",
    "book": {
        "language": ""
    }
});
            });
            </script>
        </div><script src="/gitbook/gitbook.js"></script>
<script src="/gitbook/theme.js"></script>

<script src="/gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>

<!-- <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
<script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
<script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
<script src="../gitbook/gitbook-plugin-search/search.js"></script> --></body>
</html>